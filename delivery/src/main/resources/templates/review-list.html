<!-- src/main/resources/templates/reviews-my.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>배달의 드론 | 내 리뷰</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- 폰트 -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root{
            --mint:#2AC1BC; --mint-d:#21a7a2;
            --ink:#0f172a; --muted:#64748b; --bg:#f6f7fb; --card:#ffffff;
            --border:#e5e7eb; --shadow:0 10px 24px rgba(15,23,42,.08), 0 2px 6px rgba(15,23,42,.06);
            --radius:18px; --radius-lg:22px; --gap:18px;
            --star:#f59e0b; --star-empty:#e5e7eb;
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0;
            font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
            color:var(--ink);
            background:
                    radial-gradient(circle at 0 0, rgba(15,23,42,.06) 0, rgba(15,23,42,.06) 1px, transparent 1px),
                    linear-gradient(180deg, #fafbff 0%, var(--bg) 100%);
            background-size: 18px 18px, auto;
            background-attachment: fixed;
        }

        /* 상단바 */
        .appbar{ position: sticky; top:0; z-index:50; backdrop-filter: blur(6px);
            background: rgba(255,255,255,.8); border-bottom:1px solid var(--border); }
        .appbar-inner{ max-width:1200px; margin:0 auto; padding:12px 20px;
            display:flex; align-items:center; justify-content:space-between; }
        .left-group{ display:flex; align-items:center; gap:12px; }
        .brand{ display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.2px; color:#0b3d3b; }
        .logo{ width:32px; height:32px; display:grid; place-items:center; background:var(--mint); color:#fff;
            border-radius:10px; font-weight:900; box-shadow:0 6px 14px rgba(42,193,188,.25); }
        .pill-btn{
            display:inline-flex; align-items:center; gap:6px;
            padding:8px 12px; border-radius:999px;
            background:#eef7f7; border:1px solid #e4f0f0; color:#0b3d3b;
            text-decoration:none; font-weight:800; font-size:14px;
        }
        .pill-btn:hover{ background:#e3f2f2 }
        .pill-btn.active{ background:var(--mint); color:#fff; border-color:var(--mint);
            box-shadow:0 6px 14px rgba(42,193,188,.28); }
        .nav a{ text-decoration:none; color:#64748b; margin-left:16px; font-weight:600; }
        .nav a:hover{ color:#0b3d3b }
        .nav a.active{ color:#0b3d3b; font-weight:800; }

        /* 본문 레이아웃 */
        .wrap{ max-width:1200px; margin:26px auto 80px; padding:0 20px; }
        .page-head{
            background: linear-gradient(180deg,#e9fbfa,#f7fffe);
            border:1px solid #dbf5f2; padding:22px; border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
        }
        .page-head h1{ margin:0 0 6px; font-size:28px; letter-spacing:-.3px; }
        .page-head p{ margin:0; color:var(--muted); }

        /* 리스트 */
        .list{ margin-top:14px; display:grid; gap:var(--gap); }
        .card{
            position:relative; background:var(--card); border:1px solid var(--border);
            border-radius: var(--radius-lg); padding:18px; box-shadow: var(--shadow);
        }
        .card-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
        .store-name{ font-weight:900; font-size:18px; letter-spacing:-.2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .sub{ color:var(--muted); font-size:13px; }

        .stars-read{ display:flex; gap:6px; margin:8px 0 6px; }
        .star svg{ width:22px; height:22px; fill:var(--star-empty); }
        .star.on svg{ fill:var(--star); }

        .content{ color:#3b475a; font-size:14px; line-height:1.7; margin-top:4px; }

        .cta{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
        .btn{ background:#f8fafc; border:1px solid #e5e7eb; color:#0f172a; padding:9px 12px; border-radius:12px;
            font-weight:700; text-decoration:none; }
        .btn:hover{ background:#eef2f7 }
        .btn.primary{ background:var(--mint); border-color:var(--mint); color:#fff; box-shadow:0 10px 18px rgba(42,193,188,.22); }
        .btn.primary:hover{ background:var(--mint-d) }

        .empty{
            margin:22px 0; padding:24px; border:1px dashed #cbd5e1; border-radius:16px; background:#fff;
            color:#64748b; text-align:center;
        }
        .empty strong{ color:#0b3d3b }
    </style>
</head>
<body>

<header class="appbar">
    <div class="appbar-inner">
        <div class="left-group">
            <a class="pill-btn" th:classappend="${nav} == 'my-reviews' ? ' active'"
               th:href="@{/reviews/me}">⭐ 내 리뷰</a>
            <div class="brand"><span class="logo">드</span>배달의 드론</div>
        </div>
        <nav class="nav">
            <a th:href="@{/orders}">주문내역</a>
            <a th:href="@{/account}">정보보기</a>
            <a th:href="@{/recharge}">돈충전</a>
            <a th:href="@{/settings}">설정</a>
            <a th:href="@{/logout}">로그아웃</a>
        </nav>
    </div>
</header>

<main class="wrap">
    <section class="page-head">
        <h1>내 리뷰</h1>
        <p>내가 남긴 리뷰를 한 곳에서 관리해요.</p>
    </section>

    <!-- 빈 상태 -->
    <div class="empty" th:if="${#lists.isEmpty(reviews)}">
        아직 작성한 리뷰가 없습니다. <strong><a th:href="@{/orders}">주문내역</a></strong>에서 배달완료 주문에 리뷰를 남겨보세요!
    </div>

    <!-- 리뷰 리스트 -->
    <section class="list" th:if="${!#lists.isEmpty(reviews)}">
        <article class="card" th:each="r : ${reviews}"
                 th:with="rating=${r.rating != null ? r.rating : 0}">

            <!-- 상단: 가게명(있을 때만) / 작성일 -->
            <div class="card-head">
                <!-- r.store가 있을 때만 가게명 출력 -->
                <div class="store-name" th:if="${r.store != null}" th:text="${r.store.name}">가게 이름</div>
                <div class="store-name" th:if="${r.store == null}">가게 정보 없음</div>

                <div class="sub" th:text="${#temporals.format(r.createdDate,'yyyy.MM.dd HH:mm')}">2025.09.09 12:34</div>
            </div>

            <!-- 별점(읽기 전용) -->
            <div class="stars-read" aria-hidden="true">
      <span class="star" th:each="i : ${#numbers.sequence(1,5)}"
            th:classappend="${i <= rating} ? ' on'">
        <svg viewBox="0 0 24 24"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
      </span>
            </div>

            <!-- 리뷰 내용 -->
            <div class="content" th:text="${r.content}">리뷰 내용이 여기에 표시됩니다.</div>

            <!-- 액션 -->
            <div class="cta">
                <!-- 가게 보기: r.store 있을 때만 -->
                <a class="btn" th:if="${r.store != null}" th:href="@{|/delivery/${r.store.id}|}">가게 보기</a>
                <a class="btn" th:href="@{|/reviews/${r.id}/edit|}">수정</a>

                <form th:action="@{|/reviews/${r.id}|}" method="post" style="display:inline">
                    <input type="hidden" name="_method" value="DELETE">
                    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" class="btn">삭제</button>
                </form>
            </div>
        </article>
    </section>


</main>

</body>
</html>
