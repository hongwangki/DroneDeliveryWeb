<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>배달의 드론 | 사장님 홈</title>
  <style>
    :root{
      --brand:#2AC1BC; --brand-d:#1fa6a1;
      --ink:#0f172a; --muted:#6b7280;
      --card:#ffffff; --bg:#f6f8fb; --line:#e5e7eb;
      --radius:16px; --shadow:0 8px 20px rgba(2,6,23,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}

    /* Appbar */
    header{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.8);
      backdrop-filter:saturate(1.1) blur(6px);border-bottom:1px solid rgba(15,23,42,.06)}
    .appbar-inner{max-width:1100px;margin:0 auto;padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;color:#0b2b29}
    .brand-badge{width:34px;height:34px;border-radius:10px;display:grid;place-items:center;background:var(--brand);color:#fff;font-weight:900;box-shadow:0 6px 14px rgba(42,193,188,.35)}
    .actions a{margin-left:12px;text-decoration:none;font-weight:800;padding:8px 14px;border-radius:10px;background:#fff;color:#111827;border:1px solid var(--line);transition:.2s}
    .actions a:hover{background:var(--brand);color:#fff;border-color:var(--brand)}
    .actions a.logout{color:#ef4444;border-color:#fecaca}

    /* Hero */
    .hero{max-width:1100px;margin:26px auto 0;padding:0 20px 18px;border-bottom:1px solid var(--line)}
    .hero h1{margin:0 0 6px;font-size:26px;font-weight:900}
    .hero p{margin:0;color:var(--muted);font-weight:600}

    /* Toolbar */
    .toolbar{max-width:1100px;margin:16px auto 0;padding:0 20px 6px;display:flex;gap:10px;flex-wrap:wrap}
    .input{flex:1;min-width:220px;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#f9fafb}
    .select{padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#fff}
    .btn-primary{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border-radius:10px;border:1px solid var(--brand);background:var(--brand);color:#fff;font-weight:800;text-decoration:none;transition:.2s}
    .btn-primary:hover{background:var(--brand-d)}

    /* Alerts */
    .alert{max-width:1100px;margin:16px auto 0;padding:0 20px}
    .alert > div{padding:14px 16px;border-radius:12px;font-weight:700;border:1px solid}
    .success{background:#ecfdf5;color:#065f46;border-color:#a7f3d0}
    .error{background:#fef2f2;color:#991b1b;border-color:#fecaca}

    /* Grid / Card */
    main{max-width:1100px;margin:16px auto 60px;padding:0 20px}
    .stores{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px}
    .store-link{display:block;text-decoration:none;color:inherit}
    .store-card{
      background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:16px;display:flex;flex-direction:column;transition:.2s;
      min-height:260px;
    }
    .store-card:hover{transform:translateY(-2px);box-shadow:0 12px 24px rgba(0,0,0,.08)}

    /* ✅ 썸네일: 'contain'으로 잘림 없이, 흰 배경/테두리/라운드 */
    .thumb-box{
      width:100%;
      height:168px;                /* 카드 규격에 맞춘 고정 높이 */
      border-radius:12px;
      border:1px solid #e6ecef;
      background:#ffffff;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
      margin-bottom:12px;
    }
    .thumb-img{
      width:100%; height:100%;
      object-fit:contain;          /* 잘리지 않게 전체 보이기 */
      display:block;
    }
    .thumb-placeholder{
      width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(135deg,#c8f1ef,#e6fffd);
      color:#0b2b29; font-size:24px; font-weight:900;
    }

    .store-name{font-size:18px;font-weight:900;margin:0 0 6px}
    .store-desc{font-size:13px;color:var(--muted);flex-grow:1}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#f9fafb;font-size:12px;font-weight:800}

    .no-store{text-align:center;color:#6b7280;margin:36px 0}
    .no-store a{color:var(--brand);font-weight:900;text-decoration:none}
    .no-store a:hover{text-decoration:underline}
  </style>
</head>
<body>

<header>
  <div class="appbar-inner">
    <div class="brand">
      <div class="brand-badge">드</div>
      <span th:text="${ownerName != null} ? '안녕하세요, ' + ${ownerName} + ' 사장님' : '사장님 홈'">사장님 홈</span>
    </div>
    <div class="actions">
      <a href="/account/edit">정보 수정</a>
      <a href="/logout" class="logout">로그아웃</a>
    </div>
  </div>
</header>

<section class="hero">
  <h1>내 가게 관리</h1>
  <p>사장님께서 운영 중인 가게 목록을 확인하고 관리하세요.</p>
</section>

<div class="toolbar">
  <input class="input" id="searchInput" type="search" placeholder="가게 이름 검색" />
  <select class="select" id="sortSelect" aria-label="정렬">
    <option value="name">이름순</option>
    <option value="recent">최근 생성순</option>
  </select>
  <a href="/owner/create" class="btn-primary">➕ 새 가게 만들기</a>
</div>

<div class="alert">
  <div class="success" th:if="${message}" th:text="${message}">가게 생성이 완료되었습니다.</div>
  <div class="error" th:if="${error}" th:text="${error}">에러 메시지</div>
</div>

<main>
  <div class="stores" id="storeGrid" th:if="${stores != null and !#lists.isEmpty(stores)}">
    <a class="store-link" th:each="store : ${stores}" th:href="@{'/owner/stores/' + ${store.id}}">
      <article class="store-card">
        <!-- ✅ 썸네일: 이미지 있으면 <img>, 없으면 플레이스홀더 -->
        <div class="thumb-box" th:if="${store.imageUrl != null}">
          <img class="thumb-img" th:src="${store.imageUrl}" alt="가게 이미지"
               onerror="this.parentElement.replaceWith((()=>{const d=document.createElement('div');d.className='thumb-box';d.innerHTML='<div class=&quot;thumb-placeholder&quot;>이미지</div>';return d;})())">
        </div>
        <div class="thumb-box" th:if="${store.imageUrl == null}">
          <div class="thumb-placeholder" th:text="${#strings.substring(store.name,0,1)}">가</div>
        </div>

        <h3 class="store-name" th:text="${store.name}">가게 이름</h3>
        <div class="store-desc" th:text="${store.description != null ? store.description : '소개가 아직 없어요.'}">소개가 아직 없어요.</div>
        <div class="chips">
          <span class="chip" th:text="${store.category != null ? store.category : '카테고리 미지정'}">카테고리 미지정</span>
          <span class="chip" th:text="${store.minOrderPrice != null ? '최소주문 ' + #numbers.formatInteger(store.minOrderPrice,0,'COMMA') + '원' : '최소주문 미설정'}">최소주문 미설정</span>
        </div>
      </article>
    </a>
  </div>

  <p class="no-store" th:if="${stores == null or #lists.isEmpty(stores)}">
    아직 등록된 가게가 없습니다. <a href="/owner/create">첫 가게를 생성하세요.</a>
  </p>
</main>

<script>
  const grid=document.getElementById('storeGrid');
  const search=document.getElementById('searchInput');
  const sort=document.getElementById('sortSelect');

  function updateView(){
    if(!grid) return;
    const cards=Array.from(grid.children);
    const q=(search.value||'').trim().toLowerCase();

    cards.forEach(c=>{
      const name=(c.querySelector('.store-name')?.textContent||'').toLowerCase();
      c.style.display=name.includes(q)?'':'none';
    });

    if(sort.value==='name'){
      cards.sort((a,b)=>{
        const an=a.querySelector('.store-name').textContent.trim();
        const bn=b.querySelector('.store-name').textContent.trim();
        return an.localeCompare(bn,'ko');
      }).forEach(c=>grid.appendChild(c));
    }
  }
  search&&search.addEventListener('input',updateView);
  sort&&sort.addEventListener('change',updateView);
</script>

</body>
</html>
