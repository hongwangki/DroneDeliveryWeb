<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>배달의 드론 | 사장님 홈</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#2AC1BC; --brand-d:#1fa6a1;
      --ink:#0f172a; --muted:#6b7280;
      --card:#ffffff; --bg:#f6f8fb; --line:#e5e7eb;
      --radius:16px; --shadow:0 8px 20px rgba(2,6,23,.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg); color:var(--ink);
    }

    /* Appbar (Glass + Shrink) */
    .appbar{
      position:sticky; top:0; z-index:100;
      background:linear-gradient(180deg,rgba(255,255,255,.78),rgba(255,255,255,.58));
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      border-bottom:1px solid rgba(15,23,42,.06);
    }
    .appbar::after{
      content:""; position:absolute; inset:0 0 auto 0; height:1px;
      background:linear-gradient(90deg,transparent,rgba(42,193,188,.35),transparent);
      pointer-events:none;
    }
    .appbar-inner{
      max-width:1200px; margin:0 auto;
      padding:14px 20px; transition:padding .18s ease;
      display:flex; align-items:center; justify-content:space-between;
    }
    .appbar.is-scrolled .appbar-inner{ padding:8px 20px }

    .brand{
      display:flex; align-items:center; gap:12px;
      font-weight:900; color:#0b3d3b; text-decoration:none; letter-spacing:-.2px;
    }
    .brand:hover{ color:#062f2d }
    .logo{
      width:36px; height:36px; border-radius:12px; display:grid; place-items:center;
      font-weight:900; color:#fff;
      background:
              radial-gradient(60% 60% at 30% 30%, rgba(255,255,255,.35), transparent 60%),
              linear-gradient(135deg,#2AC1BC,#16a39e);
      box-shadow:0 8px 18px rgba(42,193,188,.25), inset 0 0 0 1px rgba(255,255,255,.35);
      transform:translateZ(0); transition:transform .18s ease, box-shadow .18s ease;
    }
    .brand:hover .logo{ transform:translateY(-1px) scale(1.03) }
    .brand span:last-child{
      background:linear-gradient(90deg,#0b3d3b,#11615e);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }

    .nav{ display:flex; align-items:center; gap:6px }
    .nav a{
      position:relative; padding:8px 12px; border-radius:10px;
      text-decoration:none; color:var(--muted); font-weight:700;
      transition:color .15s ease, background-color .15s ease, transform .15s ease;
      white-space:nowrap;
    }
    .nav a::after{
      content:""; position:absolute; left:12px; right:12px; bottom:6px; height:2px;
      background:linear-gradient(90deg,#2AC1BC,#0ea5a0);
      border-radius:2px; transform:scaleX(0); transform-origin:left;
      transition:transform .18s ease;
    }
    .nav a:hover{ color:#0b3d3b; background:rgba(42,193,188,.06) }
    .nav a:hover::after{ transform:scaleX(1) }
    .nav a.active{ color:#0b3d3b; background:rgba(42,193,188,.10) }
    .nav a.active::after{ transform:scaleX(1) }

    @media (max-width:720px){
      .brand span:last-child{ display:none }
      .nav a{ padding:8px 10px }
    }

    /* Hero */
    .hero{max-width:1100px;margin:26px auto 0;padding:0 20px 18px;border-bottom:1px solid var(--line)}
    .hero h1{margin:0 0 6px;font-size:26px;font-weight:900}
    .hero p{margin:0;color:var(--muted);font-weight:600}

    /* Toolbar */
    .toolbar{max-width:1100px;margin:16px auto 0;padding:0 20px 6px;display:flex;gap:10px;flex-wrap:wrap}
    .input{flex:1;min-width:220px;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#f9fafb}
    .select{padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#fff}
    .btn-primary{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border-radius:10px;border:1px solid var(--brand);background:var(--brand);color:#fff;font-weight:800;text-decoration:none;transition:.2s}
    .btn-primary:hover{background:var(--brand-d)}

    /* Alerts */
    .alert{max-width:1100px;margin:16px auto 0;padding:0 20px}
    .alert > div{padding:14px 16px;border-radius:12px;font-weight:700;border:1px solid}
    .success{background:#ecfdf5;color:#065f46;border-color:#a7f3d0}
    .error{background:#fef2f2;color:#991b1b;border-color:#fecaca}

    /* Grid / Card */
    main{max-width:1100px;margin:16px auto 60px;padding:0 20px}
    .stores{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px}
    .store-link{display:block;text-decoration:none;color:inherit}
    .store-card{
      background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:16px;display:flex;flex-direction:column;transition:.2s;min-height:260px;
    }
    .store-card:hover{transform:translateY(-2px);box-shadow:0 12px 24px rgba(0,0,0,.08)}

    /* 썸네일 */
    .thumb-box{
      width:100%;height:168px;border-radius:12px;border:1px solid #e6ecef;background:#ffffff;
      display:flex;align-items:center;justify-content:center;overflow:hidden;margin-bottom:12px;
    }
    .thumb-img{width:100%;height:100%;object-fit:contain;display:block}
    .thumb-placeholder{
      width:100%;height:100%;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,#c8f1ef,#e6fffd);color:#0b2b29;font-size:24px;font-weight:900;
    }

    .store-name{font-size:18px;font-weight:900;margin:0 0 6px}
    .store-desc{font-size:13px;color:var(--muted);flex-grow:1}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#f9fafb;font-size:12px;font-weight:800}

    .no-store{text-align:center;color:#6b7280;margin:36px 0}
    .no-store a{color:var(--brand);font-weight:900;text-decoration:none}
    .no-store a:hover{text-decoration:underline}
  </style>
</head>
<body>

<!-- 상단바: OWNER이면 '정보보기/로그아웃'만 노출 -->
<header class="appbar" id="appbar">
  <div class="appbar-inner">
    <a class="brand" th:href="@{/home}">
      <span class="logo">드</span>
      <span>배달의 드론</span>
    </a>

    <!-- OWNER 전용 (정보보기/로그아웃만) -->
    <nav class="nav"
         th:if="${session.loginMember != null and session.loginMember.memberType != null and session.loginMember.memberType.name() == 'OWNER'}">
      <a th:href="@{/account}" th:classappend="${page=='account'} ? ' active'">정보보기</a>
      <a th:href="@{/logout}">로그아웃</a>
    </nav>

    <!-- 일반 사용자 -->
    <nav class="nav"
         th:if="${!(session.loginMember != null and session.loginMember.memberType != null and session.loginMember.memberType.name() == 'OWNER')}">
      <a th:href="@{/reviews}"  th:classappend="${page=='reviews'}  ? ' active'">나의리뷰</a>
      <a th:href="@{/orders}"   th:classappend="${page=='orders'}   ? ' active'">주문내역</a>
      <a th:href="@{/account}"  th:classappend="${page=='account'}  ? ' active'">정보보기</a>
      <a th:href="@{/recharge}" th:classappend="${page=='recharge'} ? ' active'">돈충전</a>
      <a th:href="@{/logout}">로그아웃</a>
    </nav>
  </div>
</header>

<section class="hero">
  <h1>내 가게 관리</h1>
  <p>사장님께서 운영 중인 가게 목록을 확인하고 관리하세요.</p>
</section>

<div class="toolbar">
  <input class="input" id="searchInput" type="search" placeholder="가게 이름 검색" />
  <select class="select" id="sortSelect" aria-label="정렬">
    <option value="name">이름순</option>
    <option value="recent">최근 생성순</option>
  </select>
  <a href="/owner/create" class="btn-primary">➕ 새 가게 만들기</a>
</div>

<div class="alert">
  <div class="success" th:if="${message}" th:text="${message}">가게 생성이 완료되었습니다.</div>
  <div class="error" th:if="${error}" th:text="${error}">에러 메시지</div>
</div>

<main>
  <div class="stores" id="storeGrid" th:if="${stores != null and !#lists.isEmpty(stores)}">
    <a class="store-link" th:each="store : ${stores}" th:href="@{'/owner/stores/' + ${store.id}}">
      <article class="store-card">
        <!-- 썸네일 -->
        <div class="thumb-box" th:if="${store.imageUrl != null}">
          <img class="thumb-img" th:src="${store.imageUrl}" alt="가게 이미지"
               onerror="this.parentElement.replaceWith((()=>{const d=document.createElement('div');d.className='thumb-box';d.innerHTML='<div class=&quot;thumb-placeholder&quot;>이미지</div>';return d;})())">
        </div>
        <div class="thumb-box" th:if="${store.imageUrl == null}">
          <div class="thumb-placeholder" th:text="${#strings.substring(store.name,0,1)}">가</div>
        </div>

        <h3 class="store-name" th:text="${store.name}">가게 이름</h3>
        <div class="store-desc" th:text="${store.description != null ? store.description : '소개가 아직 없어요.'}">소개가 아직 없어요.</div>
        <div class="chips">
          <span class="chip" th:text="${store.category != null ? store.category : '카테고리 미지정'}">카테고리 미지정</span>
          <span class="chip" th:text="${store.minOrderPrice != null ? '최소주문 ' + #numbers.formatInteger(store.minOrderPrice,0,'COMMA') + '원' : '최소주문 미설정'}">최소주문 미설정</span>
        </div>
      </article>
    </a>
  </div>

  <p class="no-store" th:if="${stores == null or #lists.isEmpty(stores)}">
    아직 등록된 가게가 없습니다. <a href="/owner/create">첫 가게를 생성하세요.</a>
  </p>
</main>

<!-- 헤더 축소 + 검색/정렬 스크립트 -->
<script>
  // 헤더 축소 효과
  (function(){
    const bar = document.getElementById('appbar');
    const onScroll = () => {
      if (window.scrollY > 8) bar.classList.add('is-scrolled');
      else bar.classList.remove('is-scrolled');
    };
    onScroll();
    window.addEventListener('scroll', onScroll, {passive:true});
  })();

  // 검색/정렬
  const grid=document.getElementById('storeGrid');
  const search=document.getElementById('searchInput');
  const sort=document.getElementById('sortSelect');

  function updateView(){
    if(!grid) return;
    const cards=Array.from(grid.children);
    const q=(search.value||'').trim().toLowerCase();

    cards.forEach(c=>{
      const name=(c.querySelector('.store-name')?.textContent||'').toLowerCase();
      c.style.display=name.includes(q)?'':'none';
    });

    if(sort.value==='name'){
      cards.sort((a,b)=>{
        const an=a.querySelector('.store-name').textContent.trim();
        const bn=b.querySelector('.store-name').textContent.trim();
        return an.localeCompare(bn,'ko');
      }).forEach(c=>grid.appendChild(c));
    }
    // 'recent'는 createdAt을 data-*로 싣고 비교 정렬 추가 가능.
  }
  search&&search.addEventListener('input',updateView);
  sort&&sort.addEventListener('change',updateView);
</script>

</body>
</html>
