<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title th:text="${store.name} + ' | 메뉴 & 리뷰'">배달의 드론 | 메뉴</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#2AC1BC; --brand-d:#1fa6a1;
      --ink:#0f172a; --muted:#6b7280;
      --card:#ffffff; --bg:#f6f7fb; --line:#e5e7eb;
      --shadow:0 10px 24px rgba(15,23,42,.08), 0 2px 6px rgba(15,23,42,.06);
      --radius:18px;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--ink);
      font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:linear-gradient(180deg,#fafbff 0%, var(--bg) 100%);
    }

    /* 상단바 */
    .appbar{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.8);
      backdrop-filter:blur(6px); border-bottom:1px solid var(--line)}
    .appbar-inner{max-width:1200px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;color:#0b3d3b}
    .logo{width:32px;height:32px;border-radius:10px;display:grid;place-items:center;background:var(--brand);color:#fff;box-shadow:0 6px 14px rgba(42,193,188,.25)}
    .app-actions a{padding:8px 12px;border:1px solid var(--line);border-radius:12px;text-decoration:none;color:#111827;font-weight:800;background:#fff}
    .app-actions a:hover{background:var(--brand);color:#fff;border-color:var(--brand)}

    /* 배너(기본 테마만) */
    .banner { max-width:1200px; margin:20px auto 0; padding:0 20px; }
    .banner-inner{
      border-radius:24px; min-height:120px; display:flex; align-items:center;
      border:1px solid rgba(2,6,23,.08); box-shadow:var(--shadow);
      background:linear-gradient(135deg,#e7f7f6,#f5fafc);
      padding:20px 22px;
    }
    .banner h1{margin:0; font-size:22px; font-weight:900;color:#0b3d3b}
    .banner-chip{display:inline-flex; gap:8px; margin-top:8px}
    .chip{background:#ffffff; border:1px solid rgba(2,6,23,.08); color:#0b3d3b;
      padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px;}

    /* 레이아웃 */
    .wrap{max-width:1200px; margin:16px auto 80px; padding:0 20px; display:grid; grid-template-columns: 1fr 340px; gap:18px}
    @media (max-width: 1000px){ .wrap{ grid-template-columns: 1fr } }

    /* 탭 */
    .tabs{display:flex; gap:10px; margin:14px 0}
    .tab-btn{ appearance:none; border:1px solid var(--line); background:#fff; color:#111827;
      font-weight:800; padding:8px 12px; border-radius:999px; cursor:pointer; }
    .tab-btn[aria-selected="true"]{ background:var(--brand); color:#fff; border-color:var(--brand); box-shadow:0 8px 18px rgba(42,193,188,.25) }
    .tab-panel{display:none}
    .tab-panel.active{display:block}

    /* ===== 가로 리스트형 메뉴 ===== */
    .list{display:flex; flex-direction:column; gap:10px}
    .item{
      display:flex; gap:14px; align-items:center;
      background:#fff; border:1px solid var(--line); border-radius:14px; padding:12px;
      box-shadow:var(--shadow);
      text-decoration:none; color:inherit;
    }
    .item.disabled{pointer-events:none; opacity:.5}
    .thumb{
      width:84px; height:84px; border-radius:10px; overflow:hidden;
      background:#f2f5f7; border:1px solid #e6ecef; display:grid; place-items:center; color:#0b3d3b; font-weight:900;
      flex:0 0 84px;
    }
    .thumb img{width:100%; height:100%; object-fit:cover}
    .meta{display:flex; gap:6px; align-items:center}
    .name{font-weight:900; font-size:16px}
    .price{font-weight:800}
    .muted{color:var(--muted); font-size:13px}
    .badge{background:#111827; color:#fff; font-weight:900; font-size:11px; padding:3px 8px; border-radius:999px}
    .badge.soldout{background:var(--danger)}
    .grow{flex:1}

    /* 우측: 장바구니 */
    .side{ position:sticky; top:84px; height:fit-content; background:#fff; border:1px solid var(--line);
      border-radius:18px; box-shadow:var(--shadow); padding:16px; }
    .side h3{margin:0 0 8px; font-size:18px}
    .line{height:1px; background:var(--line); margin:12px 0}

    .alert{padding:12px 14px;border-radius:12px;border:1px solid;margin:6px 0;font-weight:700}
    .ok{background:#ecfdf5;border-color:#a7f3d0;color:#065f46}
    .warn{background:#fff7ed;border-color:#ffedd5;color:#9a3412}
    .err{background:#fef2f2;border-color:#fecaca;color:#991b1b}

    .empty{color:var(--muted); text-align:center; padding:24px 0}
  </style>
</head>
<body
        th:with="
    cart=${session['cart_' + store.id]},
    total=${session.totalPrice != null ? session.totalPrice : 0},
    money=${session.loggedInMember != null ? session.loggedInMember.money : 0},
    min=${store.minOrderPrice != null ? store.minOrderPrice : 0},
    lackMin=${total < min},
    lackMoney=${money < total}
  ">

<header class="appbar">
  <div class="appbar-inner">
    <div class="brand"><span class="logo">드</span><span>배달의 드론</span></div>
    <div class="app-actions"><a th:href="@{/delivery}">← 목록으로</a></div>
  </div>
</header>

<!-- 배너(이미지 X, 기본 테마만) -->
<section class="banner">
  <div class="banner-inner">
    <div>
      <h1 th:text="${store.name}">가게 이름</h1>
      <div class="banner-chip">
        <span class="chip" th:text="${store.category}">카테고리</span>
        <span class="chip" th:text="'최소주문 ' + ${#numbers.formatInteger(min,0,'COMMA')} + '원'">최소주문 0원</span>
      </div>
    </div>
  </div>
</section>

<main class="wrap">
  <!-- 좌측 -->
  <section>
    <div class="tabs" role="tablist">
      <button id="tab-menu" class="tab-btn" role="tab" aria-controls="panel-menu" aria-selected="true">메뉴</button>
      <button id="tab-review" class="tab-btn" role="tab" aria-controls="panel-review" aria-selected="false">리뷰</button>
    </div>

    <!-- 메뉴(가로 리스트) -->
    <section id="panel-menu" class="tab-panel active">
      <div class="list">
        <a class="item"
           th:each="p : ${store.products}"
           th:href="@{/delivery/{sid}/menu/{pid}(sid=${store.id}, pid=${p.id})}"
           th:classappend="${p.quantity <= 0} ? ' disabled' : ''">
          <span class="badge soldout" th:if="${p.quantity <= 0}">품절</span>

          <div class="thumb">
            <img th:if="${p.productImageUrl != null and !#strings.isEmpty(p.productImageUrl)}"
                 th:src="${p.productImageUrl}" alt="상품 이미지">
            <span th:unless="${p.productImageUrl != null and !#strings.isEmpty(p.productImageUrl)}"
                  th:text="${#strings.substring(store.name,0,1)}">드</span>
          </div>

          <div class="grow">
            <div class="meta">
              <div class="name" th:text="${p.foodName}">메뉴명</div>
            </div>
            <div class="price" th:text="${#numbers.formatInteger(p.foodPrice,0,'COMMA')} + '원'">0원</div>
            <div class="muted" th:if="${p.quantity > 0}" th:text="'재고 ' + ${p.quantity} + '개'"></div>
            <div class="muted" th:if="${p.quantity <= 0}" style="color:var(--danger);font-weight:800">현재 품절</div>
          </div>
        </a>
      </div>

      <p th:if="${#lists.isEmpty(store.products)}" class="empty">등록된 메뉴가 없습니다.</p>
    </section>

    <!-- 리뷰 -->
    <section id="panel-review" class="tab-panel">
      <div class="side" style="box-shadow:none">
        <h3>리뷰</h3>
        <p class="muted">아직 리뷰 API가 없다면 목업 데이터나 안내 문구를 보여주세요.</p>
      </div>
    </section>
  </section>

  <!-- 우측: 장바구니 -->
  <aside class="side">
    <h3>장바구니</h3>
    <div th:if="${cart == null or #lists.isEmpty(cart)}" class="empty">담긴 상품이 없습니다.</div>

    <div th:if="${cart != null and !#lists.isEmpty(cart)}">
      <div th:each="item : ${cart}" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
        <div>
          <div style="font-weight:900" th:text="${item.productName}">메뉴명</div>
          <div class="muted" th:text="${item.quantity} + '개 · ' + ${#numbers.formatInteger(item.price,0,'COMMA')} + '원'"></div>
        </div>
        <form th:action="@{/cart/remove}" method="post">
          <input type="hidden" name="productId" th:value="${item.productId}">
          <input type="hidden" name="storeId" th:value="${store.id}">
          <button class="btn ghost" type="submit">삭제</button>
        </form>
      </div>

      <div class="line"></div>
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <span class="muted">총 결제 금액</span>
        <span class="price" th:text="${#numbers.formatInteger(total,0,'COMMA')} + '원'">0원</span>
      </div>

      <div class="alert warn" th:if="${lackMin}">
        최소주문 금액 미달: <b th:text="${#numbers.formatInteger(min,0,'COMMA')} + '원'">0원</b> 이상 주문해 주세요.
      </div>
      <div class="alert err" th:if="${!lackMin and lackMoney}">
        잔액 부족: 보유 <b th:text="${#numbers.formatInteger(money,0,'COMMA')} + '원'">0원</b>
      </div>

      <form th:action="@{/cart/checkout}" method="post" style="margin-top:12px">
        <input type="hidden" name="storeId" th:value="${store.id}">
        <button class="btn primary" style="width:100%" th:disabled="${lackMin or lackMoney}">주문 확정</button>
      </form>
    </div>
  </aside>
</main>

<script>
  const tabs=[...document.querySelectorAll('.tab-btn')];
  const panels=[...document.querySelectorAll('.tab-panel')];
  tabs.forEach(btn=>{
    btn.addEventListener('click',()=>{
      tabs.forEach(b=>b.setAttribute('aria-selected','false'));
      panels.forEach(p=>p.classList.remove('active'));
      btn.setAttribute('aria-selected','true');
      document.getElementById(btn.getAttribute('aria-controls')).classList.add('active');
    });
  });
</script>
</body>
</html>
