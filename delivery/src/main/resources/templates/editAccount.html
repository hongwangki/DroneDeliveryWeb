<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>배달의 드론 | 사용자 정보 수정</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#2AC1BC; --brand-d:#1fa6a1;
      --ink:#0f172a; --muted:#6b7280;
      --card:#ffffff; --bg:#f6f8fb;
      --line:#e5e7eb; --radius:16px;
      --shadow:0 12px 30px rgba(2,6,23,.06);
      --action-h:76px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Noto Sans KR",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background:
              radial-gradient(1200px 600px at -10% -20%, rgba(42,193,188,.08), transparent 60%),
              radial-gradient(1000px 500px at 120% 10%, rgba(42,193,188,.06), transparent 55%),
              var(--bg);
    }

    /* Appbar */
    .appbar{ position:sticky; top:0; z-index:40; background:linear-gradient(180deg,rgba(255,255,255,.78),rgba(255,255,255,.58)); -webkit-backdrop-filter: blur(12px); backdrop-filter: blur(12px); border-bottom:1px solid rgba(15,23,42,.06); }
    .appbar::after{ content:""; position:absolute; inset:0 0 auto 0; height:1px; background:linear-gradient(90deg,transparent,rgba(42,193,188,.35),transparent); pointer-events:none; }
    .appbar-inner{ max-width:1100px; margin:0 auto; padding:14px 20px; display:flex; align-items:center; justify-content:space-between; transition:padding .18s ease; }
    .appbar.is-scrolled .appbar-inner{ padding:8px 20px }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.2px; color:#0b2b29; text-decoration:none; }
    .brand-badge{ width:36px; height:36px; border-radius:12px; display:grid; place-items:center; font-weight:900; background:linear-gradient(135deg,#2AC1BC,#179e99); color:#fff; box-shadow:0 8px 18px rgba(42,193,188,.28), inset 0 0 0 1px rgba(255,255,255,.35); transition:transform .18s ease; }
    .brand:hover .brand-badge{ transform:translateY(-1px) scale(1.03) }
    .brand span{ background:linear-gradient(90deg,#0b3d3b,#11615e); -webkit-background-clip:text; background-clip:text; color:transparent; font-size:18px; }

    .nav{ display:flex; align-items:center; gap:6px }
    .nav a{ position:relative; padding:8px 12px; border-radius:10px; text-decoration:none; color:#6b7280; font-weight:800; transition:color .15s ease, background-color .15s ease; }
    .nav a::after{ content:""; position:absolute; left:12px; right:12px; bottom:6px; height:2px; background:linear-gradient(90deg,#2AC1BC,#0ea5a0); border-radius:2px; transform:scaleX(0); transform-origin:left; transition:transform .18s ease; }
    .nav a:hover{ color:#0b3d3b; background:rgba(42,193,188,.06) }
    .nav a:hover::after{ transform:scaleX(1) }
    .nav a.active{ color:#0b3d3b; background:rgba(42,193,188,.10) }
    .nav a.active::after{ transform:scaleX(1) }

    @media (max-width:720px){
      .brand span{ display:none }
      .nav a{ padding:8px 10px }
    }

    /* Hero */
    .hero{ max-width:1100px; margin:26px auto 0; padding:0 20px 6px; display:flex; align-items:end; justify-content:space-between; border-bottom:1px solid var(--line); }
    .hero h1{ margin:0; font-size:28px; font-weight:900; letter-spacing:.2px }
    .hero p{ margin:6px 0 16px; color:var(--muted); font-weight:500 }

    /* Layout */
    .wrap{ max-width:1100px; margin:18px auto; padding:0 20px; display:grid; grid-template-columns:280px 1fr; gap:22px; padding-bottom:calc(var(--action-h) + 30px); }

    /* Profile + Card */
    .profile,.card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px; }
    .avatar{ width:90px; height:90px; border-radius:50%; background:linear-gradient(135deg,#c8f1ef,#e6fffd); border:3px solid #fff; box-shadow:0 8px 20px rgba(42,193,188,.25); display:grid; place-items:center; font-weight:900; color:#0b2b29; font-size:28px; margin-bottom:12px; }
    .profile .name{ font-size:20px; font-weight:800; margin:6px 0 2px }
    .profile .email{ color:#6b7280; font-size:14px }
    .profile hr{ border:none; border-top:1px solid var(--line); margin:16px 0 }
    .profile .tip{ font-size:13px; color:#6b7280; line-height:1.6 }

    .section-title{ font-weight:800; margin:4px 0 14px; }

    form{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:14px 20px }
    .col-2{ grid-column:span 2 }

    label{ display:block; font-size:13px; font-weight:700; color:#334155; margin:4px 0 6px }

    input{
      width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:10px;
      background:#f9fafb; font-size:15px; transition:border-color .15s, box-shadow .15s, background .15s;
    }
    input:focus{ outline:none; border-color:#8ee2df; background:#fff; box-shadow:0 0 0 4px rgba(42,193,188,.15) }

    /* Validation styles */
    .field-error{ border-color:#dc2626 !important; background:#fff7f7 }
    .error-text{ margin-top:6px; font-size:12px; color:#b91c1c; font-weight:700 }
    .alert{ padding:12px 14px; border-radius:12px; background:#fef2f2; border:1px solid #fecaca; color:#991b1b; font-weight:700; margin-bottom:14px }

    /* Bottom Actions */
    .actions{ position:fixed; left:0; right:0; bottom:0; z-index:15; display:flex; justify-content:center; padding:14px 16px max(14px, env(safe-area-inset-bottom)); background:linear-gradient(180deg, rgba(246,248,251,0), rgba(246,248,251,.92) 40%, rgba(246,248,251,.98)); border-top:1px solid rgba(15,23,42,.06); backdrop-filter: blur(6px); min-height:var(--action-h); }
    .actions-inner{ width:100%; max-width:1100px; display:flex; gap:10px; justify-content:flex-end; }
    .btn{ appearance:none; border:none; border-radius:12px; padding:12px 18px; font-weight:800; cursor:pointer; transition:transform .05s, box-shadow .15s, background .15s; }
    .btn:active{ transform:translateY(1px) }
    .btn-ghost{ background:#fff; border:1px solid var(--line); color:#111827 }
    .btn-ghost:hover{ box-shadow:0 8px 20px rgba(2,6,23,.06) }
    .btn-brand{ background:var(--brand); color:#fff; min-width:190px; box-shadow:0 8px 22px rgba(42,193,188,.35); }
    .btn-brand:hover{ background:var(--brand-d) }

    .badge-ok{ display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; font-weight:700; font-size:14px; }

    @media (max-width:960px){
      .wrap{ grid-template-columns:1fr }
      .actions-inner{ justify-content:stretch }
      .btn-brand{ flex:1 }
    }
  </style>
</head>
<body>

<!-- App Bar -->
<header class="appbar" id="appbar">
  <div class="appbar-inner">
    <a class="brand" th:href="@{/home}">
      <div class="brand-badge">드</div>
      <span>배달의 드론</span>
    </a>

    <nav class="nav"
         th:with="
           loginMember=${session['loginMember']},
           isOwner=${loginMember != null and loginMember.memberType == T(drone.delivery.domain.MemberType).OWNER}
         ">
      <a th:if="${!isOwner}" th:href="@{/reviews}"  th:classappend="${page=='reviews'} ? ' active'">나의리뷰</a>
      <a th:if="${!isOwner}" th:href="@{/orders}"   th:classappend="${page=='orders'} ? ' active'">주문내역</a>
      <a th:if="${!isOwner}" th:href="@{/recharge}" th:classappend="${page=='recharge'} ? ' active'">돈충전</a>
      <a th:href="@{/account}" th:classappend="${page=='account' || page=='account-edit'} ? ' active'">정보보기</a>
      <a th:href="@{/logout}">로그아웃</a>
    </nav>
  </div>
</header>

<!-- Page Hero -->
<section class="hero">
  <div>
    <h1>사용자 정보 수정</h1>
    <p>내 정보와 배송지를 최신 상태로 유지하세요.</p>
  </div>
  <div th:if="${successMessage}" class="badge-ok" th:text="${successMessage}">변경이 저장되었습니다.</div>
</section>

<!-- Page Body -->
<main class="wrap">
  <!-- Left: profile summary -->
  <aside class="profile">
    <div class="avatar" th:text="${#strings.substring(member.name,0,1)}">드</div>
    <div class="name" th:text="${member.name}">홍길동</div>
    <div class="email" th:text="${member.email}">hong@example.com</div>
    <hr>
    <p class="tip">
      비밀번호를 변경하지 않으려면 빈 칸으로 두세요.<br/>
      주소는 배달 가능 지역 산정에 사용됩니다.
    </p>
    <hr>
    <button class="btn btn-ghost" type="button" onclick="location.href='/account'">내 정보로 돌아가기</button>
  </aside>

  <!-- Right: editable form (UpdateMemberDTO 바인딩) -->
  <section class="card">
    <h3 class="section-title">기본 정보</h3>

    <form th:action="@{/account/edit}" method="post" th:object="${updateMemberDTO}">
      <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

      <div th:if="${#fields.hasGlobalErrors()}" class="alert" th:errors="*{__all__}">
        입력값을 다시 확인하세요.
      </div>

      <div class="col-2">
        <label for="name">이름</label>
        <input id="name" type="text" th:field="*{name}"
               required
               pattern="^[가-힣a-zA-Z]+$"
               title="한글 또는 영문만 입력하세요"
               th:classappend="${#fields.hasErrors('name')} ? ' field-error'">
        <div class="error-text" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">이름 오류</div>
      </div>

      <div class="col-2">
        <label for="email">이메일</label>
        <input id="email" type="email" th:field="*{email}"
               placeholder="변경 시만 입력"
               autocomplete="email" autocapitalize="off" spellcheck="false"
               pattern="^[A-Za-z0-9._%+-]+@([A-Za-z0-9-]+\\.)+[A-Za-z]{2,6}$"
               title="아이디@도메인.최상위도메인 형식(예: user@example.com)"
               th:classappend="${#fields.hasErrors('email')} ? ' field-error'">
        <div class="error-text" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">이메일 오류</div>
      </div>

      <h3 class="section-title col-2" style="margin-top:6px">주소 정보</h3>

      <div class="col-2">
        <label for="street">도로명 주소</label>
        <input id="street" type="text" th:field="*{street}"
               required
               th:classappend="${#fields.hasErrors('street')} ? ' field-error'">
        <div class="error-text" th:if="${#fields.hasErrors('street')}" th:errors="*{street}">도로명 주소 오류</div>
      </div>

      <div>
        <label for="city">도시</label>
        <input id="city" type="text" th:field="*{city}"
               required
               th:classappend="${#fields.hasErrors('city')} ? ' field-error'">
        <div class="error-text" th:if="${#fields.hasErrors('city')}" th:errors="*{city}">도시 오류</div>
      </div>

      <div>
        <label for="zipcode">우편번호</label>
        <input id="zipcode" type="text" th:field="*{zipcode}"
               required
               pattern="[0-9]{5}"
               maxlength="5"
               inputmode="numeric"
               title="우편번호는 5자리 숫자입니다."
               oninput="this.value = this.value.replace(/[^0-9]/g,'').slice(0,5)"
               th:classappend="${#fields.hasErrors('zipcode')} ? ' field-error'">
        <div class="error-text" th:if="${#fields.hasErrors('zipcode')}" th:errors="*{zipcode}">우편번호 오류</div>
      </div>

      <div class="col-2">
        <label for="detailAddress">상세 주소</label>
        <input id="detailAddress" type="text" th:field="*{detailAddress}"
               required
               th:classappend="${#fields.hasErrors('detailAddress')} ? ' field-error'">
        <div class="error-text" th:if="${#fields.hasErrors('detailAddress')}" th:errors="*{detailAddress}">상세 주소 오류</div>
      </div>

      <h3 class="section-title col-2" style="margin-top:6px">보안</h3>

      <div class="col-2">
        <label for="password">새 비밀번호</label>
        <input id="password" type="password" th:field="*{password}"
               placeholder="변경하지 않으려면 비워두세요"
               th:classappend="${#fields.hasErrors('password')} ? ' field-error'">
        <div class="error-text" th:if="${#fields.hasErrors('password')}" th:errors="*{password}">비밀번호 오류</div>
      </div>

      <button type="submit" style="position:absolute; left:-9999px; width:1px; height:1px">submit</button>
    </form>
  </section>
</main>

<!-- Bottom Action Bar -->
<div class="actions">
  <div class="actions-inner">
    <button class="btn btn-ghost" type="button" onclick="history.back()">취소</button>
    <button class="btn btn-brand" type="button" onclick="document.querySelector('form').requestSubmit()">변경 사항 저장</button>
  </div>
</div>
<script>
  (function(){
    const bar = document.getElementById('appbar');
    const onScroll = () => {
      if (window.scrollY > 8) bar.classList.add('is-scrolled');
      else bar.classList.remove('is-scrolled');
    };
    onScroll();
    window.addEventListener('scroll', onScroll, {passive:true});
  })();
</script>

</body>
</html>
